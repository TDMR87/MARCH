<div id="navMenu" 
     class="column is-3" 
     hx-get="/nav" 
     hx-trigger="login from:body, logout from:body" 
     hx-target="this" 
     hx-swap="outerHTML">

    <span class="icon is-large block toggle-button" 
          hx-post="/nav"
          hx-trigger="click" 
          hx-target="#navMenu" 
          hx-swap="outerHTML" 
          hx-ext='json-enc' 
          hx-vals='{"IsCollapsed": @Model.IsCollapsed.ToString().ToLower()}'>
        @if (Model.IsCollapsed)
        {
            <i class="fas fa-bars"></i>
        }
        else
        {
            <i class="fas fa-times"></i>
        }
    </span>

    <aside class="menu" id="side-menu" style="display: @(Model.IsCollapsed ? "none" : string.Empty)">

        <p class="menu-label">General</p>
        <ul class="menu-list">
            <li>
                <a hx-get="/home"
                   hx-push-url="true"
                   hx-trigger="click" 
                   hx-target="#mainContentArea" 
                   hx-swap="innerHTML"
                   hx-on::before-request="toggleNavButton()">
                   Home
                </a>
            </li>
            <li>
                <a hx-get="/how-it-works"
                   hx-push-url="true"
                   hx-trigger="click" 
                   hx-target="#mainContentArea" 
                   hx-swap="innerHTML"
                   hx-on::before-request="toggleNavButton()">
                   How it works
                </a>
            </li>
        </ul>

        <p class="menu-label">Demo</p>
        <ul class="menu-list">
            <li>
                <a hx-get="/counter"
                   hx-push-url="true"
                   hx-trigger="click" 
                   hx-target="#mainContentArea" 
                   hx-swap="innerHTML" 
                   hx-ext='json-enc'
                   hx-on::before-request="toggleNavButton()">
                   Counter
                </a>
            </li>
            <li>
                <a hx-get="/form"
                   hx-push-url="true"
                   hx-trigger="click"
                   hx-target="#mainContentArea"
                   hx-swap="innerHTML"
                   hx-ext='json-enc'
                   hx-on::before-request="toggleNavButton()">
                    Form
                </a>
            </li>
            
        </ul>

        <p class="menu-label">Auth</p>
        <ul class="menu-list">
            @if (HttpContextAccessor?.HttpContext?.User.Identity?.IsAuthenticated == false)
            {
                <li>
                    <a hx-get="/login"
                       hx-push-url="true"
                       hx-trigger="click"
                       hx-target="#mainContentArea"
                       hx-swap="innerHTML"
                       hx-ext='json-enc'
                       hx-on::before-request="toggleNavButton()">
                       <b>Log in</b>
                    </a>
                </li>
            }
            else
            {
                <li>
                    <a hx-get="/logout"
                       hx-push-url="/home"
                       hx-trigger="click"
                       hx-target="#mainContentArea"
                       hx-swap="innerHTML"
                       hx-ext='json-enc'
                       hx-on::before-request="toggleNavButton()">
                       Log out
                    </a>
                </li>
                <li>
                    <a hx-get="/admin/dashboard"
                       hx-push-url="true"
                       hx-trigger="click"
                       hx-target="#mainContentArea"
                       hx-swap="innerHTML"
                       hx-ext='json-enc'
                       hx-on::before-request="toggleNavButton()">
                       Admin dashboard
                    </a>
                </li>
            }
        </ul>
    </aside>
</div>

<script>
    function isSmallScreen() {
        return window.matchMedia("(max-width: 768px)").matches;
    }

    function toggleNavButton() {
        const navButton = document.querySelector('.toggle-button');
        if (isSmallScreen() && navButton) {
            navButton.click();
        }
    }
</script>

@code
{
    [Inject] public IHttpContextAccessor? HttpContextAccessor { get; set; }

    [Parameter] public NavModel Model { get; set; } = new() { IsCollapsed = false };

    public class NavModel
    {
        public bool IsCollapsed { get; set; }
    }
}
